#!/usr/bin/env python

import curses

from pytask.view import CurseView
from pytask.model import Tasklist


class PyTaskApp:
    def __init__(self):
        self.tasklists = Tasklist.all()
        self.view = CurseView(self.tasklists)

    def application(self):
        while True:
            c = self.view.stdscr.getch()
            if c == ord('q'):
                self.view.quit()
                break
            elif c == ord('k') or c == ord('j'):
                self.view.move(c)
            elif c == ord('\t'):
                self.view.switch_window(c)
            elif c == ord('h') or c == ord('l'):
                self.view.switch_window(c)
            elif c == ord('o'):
                task_name = self.input()
                self.view.btext.text = ''
                self.view.btext.redraw()
                if len(task_name) > 0:
                    self.tasklists.append(Tasklist.create(title=task_name))
                    self.view.move(ord('k'))

    def input(self):
        text = ''
        self.view.btext.text = f'Tasklist title : {text}'
        self.view.btext.redraw()
        while True:
            c = self.view.stdscr.getch()
            if c == 10:
                return text
            elif c == 27:
                return ''
            elif c == 127:
                if len(text) > 0:
                    text = text[:-1]
                    self.view.btext.redraw()
                else:
                    curses.beep()
            elif ord('A') < c < ord('z'):
                text += chr(c)
                self.view.btext.text = f'Tasklist title : {text}'
                self.view.btext.redraw()






PyTaskApp().application()
